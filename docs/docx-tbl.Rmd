---
title: "Untitled"
author: "Ben Best"
date: "January 17, 2018"
output:
  bookdown::word_document2:
    toc: yes
---

```{r setup, include=FALSE}
library(knitr)
library(kableExtra)
opts_chunk$set(echo = F, eval=F, message = F, warning=F)

# brew install pandoc; brew link --overwrite pandoc
# brew install pandoc-citeproc
# mv /usr/local/bin/pandoc-citeproc \
#    /usr/local/bin/pandoc-citeproc_0.3.1
# ln -s /usr/local/Cellar/pandoc-citeproc/0.13/bin/pandoc-citeproc \
#       /usr/local/bin/pandoc-citeproc
# devtools::install_github("rstudio/bookdown")

#options(knitr.table.format = "html") 
```

## officer emf

- [Officer and graphics • officer package](https://davidgohel.github.io/officer/articles/offcran/graphics.html#word-documents-and-graphics)

```{r, eval=T}
library(tidyverse)
library(here)
library(glue)
library(officer)
library(devEMF)
library(cowplot)

dir_img <- here("docs/figs/bars")

pct <- 30
w <- 100
h <- 10
dpi <- 300
redo <- F

zpad <- function(v, width=3, side="left", pad="0"){
  str_pad(string=v, width=width, side=side, pad=pad)
}


for (pct in 0:100){

  fig <- glue("{dir_img}/bar_w{zpad(w)}_h{zpad(h)}_pct{zpad(pct)}.png")

  if (!file.exists(fig) | redo){
    d <- data_frame(
      id   = c('', ''), 
      pct  = c(pct, 100-pct), 
      type = factor(c("in", "out"), levels=c("out", "in")))
    g <- ggplot(data = d, aes(x = id, y = pct, fill = factor(type)))+
      #geom_bar(stat="identity") +
      geom_col() +
      scale_fill_manual(values = c("in"="black", "out"="lightgray")) +
      coord_flip() + 
      cowplot::theme_nothing() + 
      scale_y_continuous(expand=c(0,0))
    g
    
    png(fig, width = w, height = h, res = dpi)
    print(g)
    dev.off()
  }
}

```

## kable

## NREL Long table w/ kable

```{r}
ter      <- "Hawaii"
bin      <- "depth"
bin_cap  <- "Depth"
bin_html <- "Depth (m)"

tbl_blsp <- ter_bin_lyr_smry_plus(ter, bin, lyr_params, lyr_categories)
print_tbl_ter_bin_lyr_smry_plus(tbl_blsp)
```


```{r, eval=F}
library(kableExtra)
d = data_frame(
  letter    = sample(letters, 10),
  pct       = sample(0:100, 10), 
  #pct_png   = glue("{dir_img}/bar_w{zpad(w)}_h{zpad(h)}_pct{zpad(pct)}.png"),
  pct_png   = glue("{dir_img}/bar_w{zpad(w)}_h{zpad(h)}_pct{zpad(pct)}.png"),
  indicator = glue('![]({pct_png})'))

d %>%
  select(-pct_png)  %>%
  kable() %>%
  kable_styling()#%>%
  #kable_styling(bootstrap_options = c("striped", "condensed"))
```

## kable + sprinkles

```{r, eval=F}
library(pixiedust)

d %>%
  select(-pct_png)  %>%
  dust() %>%
  #kable() %>%
  sprinkle(bg_pattern = c("lightgray", "white"))
  #kable_styling(bootstrap_options = c("striped", "condensed"))
```

%>% 
  sprinkle(bg_pattern = c("orchid", "plum"))

## pander

```{r, eval=F}
library(pander)
panderOptions('table.alignment.default', function(df)
    ifelse(sapply(df, is.numeric), 'right', 'left'))
panderOptions('table.split.table', Inf)
panderOptions('big.mark', ",")
panderOptions('keep.trailing.zeros', TRUE)

d %>%
  select(-pct_png)  %>%
  pander()
```


## flextable

```{r, eval=F}
library(officer)
library(flextable)

ft <- d %>%
  #select(-pct_png) %>%
  #select(-indicator) %>%
  #kable()
  flextable() #%>%
  #theme_zebra()

display(
  ft, col_key = "indicator", i = ~ !is.na(pct_png), pattern = "{{pct_img}}",
  formatters = list(
    pct_img ~ external_img(src = pct_png, width = w/dpi, height=h/dpi)))
```


## General

[Happy collaboration with Rmd to docx](http://rmarkdown.rstudio.com/articles_docx.html)

## Short Table

See \@ref(tab:tblShort)

```{r tblShort}
kable(
  head(mtcars[, 1:8], 10), booktabs = TRUE,
  caption = 'A table of the first 10 rows of the mtcars data.')
```

## Long Table

See \@ref(tab:tblLong)

```{r tblLong}
# kable(
#   iris[1:55, ], longtable = TRUE, booktabs = TRUE,
#   caption = 'A table generated by the longtable package.') %>%
#   kable_styling(bootstrap_options = c("striped", "condensed"))
# library(pander)
# panderOptions('table.alignment.default', function(df)
#     ifelse(sapply(df, is.numeric), 'right', 'left'))
# panderOptions('table.split.table', Inf)
# panderOptions('big.mark', ",")
# panderOptions('keep.trailing.zeros', TRUE)
# pandoc.table(
#   iris[1:55, ], longtable = TRUE, booktabs = TRUE,
#   caption = 'A table generated by the longtable package.') %>%
#   kable_styling(bootstrap_options = c("striped", "condensed"))
library(flextable)
flextable(iris[1:55,])
```

## Figure

You can also embed plots. See .

```{r plotPressure, fig.cap="Test caption here."}
#\@ref(fig:pltPressure)
plot(pressure)
```


## flextable

[integration with sparkline · Issue #1 · davidgohel/flextable](https://github.com/davidgohel/flextable/issues/1)

```{r, eval=F}
library(dplyr)
#library(oxbase) # devtools::install_github("davidgohel/oxbase")
library(officer)
library(flextable)
library(sparkline)
library(dplyr)
library(htmltools)
library(htmlwidgets)

as.character.htmlwidget <- function(x, ...) {
  htmltools::HTML(
    htmltools:::as.character.shiny.tag.list(
      htmlwidgets:::as.tags.htmlwidget(
        x
      ),
      ...
    )
  )
}

add_deps <- function(dtbl, name, pkg = name) {
  tagList(
    dtbl,
    htmlwidgets::getDependency(name, pkg)
  )
}
mtcars %>%
  group_by(cyl) %>%
  summarise(
    spk = as.character(sparkline(hp, type="bar")),
    detail_tbl = as.character(
      flextable(
        data.frame(
          hp = hp,
          mpg = mpg,
          spk = rep(as.character(sparkline(1:10, type="line")), length(hp))
        )
      ) #%>%
      #tabwid()
    )
  ) %>%
  flextable() %>%
  #tabwid() %>%
  onRender(htmlwidgets::JS(
'function(el,x){
  debugger;
  HTMLWidgets.staticRender();
}'    
  )) %>%
  add_deps("sparkline", "sparkline") %>%
  browsable()
```

[flextable examples • flextable](https://davidgohel.github.io/flextable/articles/examples.html)

* [Text rotation - Format flextable objects • flextable](https://davidgohel.github.io/flextable/articles/format.html#text-rotation)
* [Apply zebra theme — theme_zebra • flextable](https://davidgohel.github.io/flextable/reference/theme_zebra.html)
* [get a flextable from a xtable object — xtable_to_flextable • flextable](https://davidgohel.github.io/flextable/reference/xtable_to_flextable.html)

## sparkTable

[r - Add sparkline graph to a table - Stack Overflow](https://stackoverflow.com/questions/32841221/add-sparkline-graph-to-a-table)

```{r, eval=F}
pacman::p_load(sparkTable)
sl <- newSparkLine(
  values = rnorm (25), 
  lineWidth = .18, pointWidth = .4, width = .4, height = .08)
export(sl , outputType = "png", filename = "sparkLine ")
```


## microplot

```{r}
library(microplot)


microplot::MSWord_TablePlusGraphicColumn()

demo("tablesPlusGraphicColumn", package="microplot", ask=FALSE) ## both "word" and latex
```

/Library/Internet Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/bin/java

cd /Library/Frameworks/R.framework/Versions/3.4/Resources/lib
ln -s /Library/Java/JavaVirtualMachines/jdk1.8.0_144.jdk/Contents/Home/jre/lib/server/libjvm.dylib libjvm.dylib

/usr/local/lib/libjvm.dylib: mach-o, but wrong architecture
$(JAVA_HOME)/lib/server
/Library/Internet\ Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/bin/java -version

```bash
cd /Library/Frameworks/R.framework/Versions/3.4/Resources/lib
ln -s /Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Libraries/libjvm.dylib libjvm.dylib
# removed


http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html


[Run rJava with RStudio under OSX 10.10, 10.11 (El Capitan) or 10.12 (Sierra) · MTFA/CohortEx Wiki](https://github.com/MTFA/CohortEx/wiki/Run-rJava-with-RStudio-under-OSX-10.10,-10.11-(El-Capitan)-or-10.12-(Sierra))

/usr/libexec/java_home -V

R CMD javareconf


```

[java - rJava load error in RStudio/R after "upgrading" to OSX Yosemite - Stack Overflow](https://stackoverflow.com/questions/30738974/rjava-load-error-in-rstudio-r-after-upgrading-to-osx-yosemite#answer-40640416)
